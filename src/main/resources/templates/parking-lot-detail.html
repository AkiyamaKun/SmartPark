<!doctype html>

<html class="no-js" lang="en" xmlns:th="http://www.thymeleaf.org">

<div th:replace="shared/head :: head"></div>

<body>

<div th:replace="shared/left_panel :: left_panel"></div>

<div id="right-panel" class="right-panel">

    <div th:replace="shared/header :: header"></div>

    <div th:replace="shared/breadcrumbs :: breadcrumbs"></div>

    <div class="col-lg-6">
        <div class="card">
            <div class="card-header">
                <b>Parking Lot</b>
                <button type="button" id="btnDeactive" class="btn btn-danger float-right">
                    <i class="fa fa-ban"></i> Deactive
                </button>
            </div>
            <div class="card-body card-block" id="parkinglot-form">
                <input id="ownerId" th:value="${plot.owner.ownerId}" type="hidden">
                <input id="parkingLotId" type="hidden" th:value="${plot.parkingLotId}"/>
                <input id="accountId" type="hidden" th:value="${session.User.accountId}"/>
                <div class="form-group">
                    <label for="displayName" class=" form-control-label">Name</label>
                    <input type="text" id="displayName" th:value="${plot.displayName}" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="long" class=" form-control-label">Longitude</label>
                    <input type="text" id="long" th:value="${plot.longitude}" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="lat" class=" form-control-label">Latitude</label>
                    <input type="text" id="lat" th:value="${plot.latitude}" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="timeOfOperation" class=" form-control-label">Time Of Operation</label>
                    <input type="text" id="timeOfOperation" th:value="${plot.timeOfOperation}" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="totalSlot" class=" form-control-label">Total Slot</label>
                    <input type="text" id="totalSlot" th:value="${plot.totalSlot}" class="form-control" disabled>
                </div>
                <div class="form-group">
                    <label for="address" class=" form-control-label">Address</label>
                    <input type="text" id="address" th:value="${plot.address}" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="phoneNumberPlot" class=" form-control-label">Phone Number</label>
                    <input type="text" id="phoneNumberPlot" th:value="${plot.phoneNumber}" class="form-control" required>
                </div>
            </div>
            <div class="card-footer">
                <button id="btn-save" type="button" class="btn btn-primary float-right" disabled>
                    <i class="fa fa-pencil"></i> Save
                </button>
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="row form-group">
            <div class="col col-md-12">
                <div class="input-group">
                    <input type="text" id="input2-group2" name="input2-group2" placeholder="Search Owner" class="form-control" style="margin-right: 10px;">
                    <div class="input-group-btn"><button class="btn btn-primary"><i class="fa fa-search"></i>&nbsp;Search</button></div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header">
                <b>Owner</b>
            </div>
            <div class="card-body card-block">
                <!--<ul class="nav nav-tabs" id="myTab" role="tablist">-->
                    <!--<li class="nav-item">-->
                        <!--<a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"-->
                           <!--aria-controls="home" aria-selected="true">Parking Lot #8</a>-->
                    <!--</li>-->
                    <!--<li class="nav-item dropdown">-->
                        <!--<a class="nav-link dropdown-toggle" id="home-tab" data-toggle="dropdown" href="#home" role="button" aria-haspopup="true" aria-expanded="false">Parking Lot #8<span class="caret"></span></a>-->
                        <!--<div class="dropdown-menu">-->
                            <!--<a class="dropdown-item" href="#">Submenu 1-1</a>-->
                            <!--<a class="dropdown-item" href="#">Submenu 1-2</a>-->
                            <!--<a class="dropdown-item" href="#">Submenu 1-3</a>-->
                        <!--</div>-->
                    <!--</li>-->
                <!--</ul>-->
                <div class="tab-content pl-3 p-1" id="myTabContent">
                    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                        <div class="form-group row">
                            <div class="col col-sm-3">
                                <label for="firstName" class=" form-control-label">First Name</label>
                            </div>
                            <div class="col-12 col-sm-9">
                                <input type="text" id="firstName" th:value="${plot.owner.firstName}" class="form-control" disabled>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col col-sm-3">
                                <label for="lastName" class=" form-control-label">Last Name</label>
                            </div>
                            <div class="col-12 col-sm-9">
                                <input type="text" id="lastName" th:value="${plot.owner.lastName}" class="form-control" disabled>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col col-sm-3">
                                <label for="phoneNumber" class=" form-control-label">Phone Number</label>
                            </div>
                            <div class="col-12 col-sm-9">
                                <input type="number" id="phoneNumber" th:value="${plot.owner.phoneNumber}" class="form-control" disabled>
                            </div>
                        </div>
                        <!--<button type="button" class="btn btn-danger float-left" disabled>-->
                            <!--<i class="fa fa-ban"></i> Cancel-->
                        <!--</button>-->
                        <!--<button type="button" class="btn btn-primary float-right">-->
                            <!--<i class="fa fa-pencil"></i> Edit-->
                        <!--</button>-->
                        <!--<button type="button" class="btn btn-danger float-right">-->
                            <!--<i class="fa fa-trash-o"></i> Deactive-->
                        <!--</button>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="vendors/jquery/dist/jquery.min.js"></script>
<script src="vendors/popper.js/dist/umd/popper.min.js"></script>
<script src="vendors/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="assets/js/main.js"></script>
<script src="/js/app.js"></script>

<script src="vendors/jqvmap/dist/jquery.vmap.min.js"></script>
<script src="vendors/jqvmap/examples/js/jquery.vmap.sampledata.js"></script>
<script src="vendors/jqvmap/dist/maps/jquery.vmap.world.js"></script>

</body>
<script>

    ready(function () {
        document.getElementById("btn-save").addEventListener("click", function () {
            updateParkingLot();
        });

        document.getElementById("btnDeactive").addEventListener("click", function () {
            deactiveParkingLot();
        })

        $("#parkinglot-form input").keydown(function (event) {
            $("#btn-save").prop("disabled", false);
            //Validate
            validateInput();
        });
    });

    function updateParkingLot() {
        let validateData = validateInput();
        let parkingLotId = document.getElementById("parkingLotId").value;
        let displayName = document.getElementById("displayName").value;
        let longitude = document.getElementById("long").value;
        let latitude = document.getElementById("lat").value;
        let timeOfOperation = document.getElementById("timeOfOperation").value;
        let totalSlot = document.getElementById("totalSlot").value;
        let address = document.getElementById("address").value;
        let phoneNumber = document.getElementById("phoneNumberPlot").value;
        let accountId = document.getElementById("accountId").value;
        let ownerId = document.getElementById("ownerId").value;
        let active = true;

        if (validateData) {
            CallAjaxWithFetch(`/admin/update_parking_lot/${accountId}`,
                "PUT",
                {parkingLotId, displayName, longitude, latitude, address, phoneNumber, timeOfOperation, ownerId, active, totalSlot},
                (data) => {
                    showAlert(true, data.message);
                    document.location.href = "/list-parking-lots";
                },
                (err) => {
                    showAlert(false, err.message);
                }
            )
        }
    };

    function deactiveParkingLot() {

        let parkingLotId = document.getElementById("parkingLotId").value;

        CallAjaxWithFetch(`/admin/deactive_parking_lot/${parkingLotId}`,
            "PUT",
            (data) => {
                showAlert(true, data.message);
                document.location.href = "/list-parking-lots";
            },
            (err) => {
                showAlert(false, err.message);
            }
        )
    };

    function validateInput() {
        let validateMessage = '';

        let displayName = $("#name").val().trim();
        let long = $("#long").val().trim();
        let lat = $("#lat").val().trim();
        let slots = $("#slots").val().trim();
        let phoneNumber = $("#phoneNumberPlot").val().trim();
        let address = $("#address").val().trim();
        let timeOfOperation = $("#timeOfOperation").val().trim();

        let floatRegex = /^[+-]?\d+(\.\d+)?$/;
        let intRegex = /\d+/;
        let phoneRegex = /0\d{9}/;

        if (displayName.length === 0) {
            validateMessage = 'Display Name is required!';
        } else if (!floatRegex.test(long) || !floatRegex.test(lat)) {
            validateMessage = 'Long and lat should be float number!';
        } else if (!intRegex.test(slots) || parseInt(slots) === 0) {
            validateMessage = 'Total slots should be positive integer number!';
        } else if (!phoneRegex.test(phoneNumber)) {
            validateMessage = 'Phone number should follow format 0#########';
        } else if (timeOfOperation.length === 0) {
            validateMessage = 'Time of operation is required!';
        } else if (address.length === 0) {
            validateMessage = 'Address is required!';
        }

        if (validateMessage.length) {
            showAlert(false, validateMessage);
            return null;
        }

        return {
            displayName: displayName,
            longitude: parseFloat(long),
            latitude: parseFloat(lat),
            totalSlot: parseInt(slots),
            address: address,
            phoneNumber: phoneNumber,
            timeOfOperation: timeOfOperation
        }
    }


</script>
</html>